{% extends "layouts/main.html" %}

{% set pageName = 'Your data has passed our checks and can be published' %}

{% block beforeContent %}
  {{ govukBackLink({
    text: "Back",
    href: "javascript:window.history.back()"
  }) }}
{% endblock %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-l">
    {{pageName}}
  </h1>

  <p>Hereâ€™s a preview of how your data will show on a map:</p>

  <div id="map" class="app-map"></div>

  {{ govukButton({
    text: "Continue",
    href: "/confirmation"
  }) }}
    </div>
  </div>



  </div>
</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script>
    var map = new maplibregl.Map({
        container: 'map', // container id
        style: 'https://demotiles.maplibre.org/style.json', // style URL
        center: [-0.15778393023663284, 51.54490132506487], // starting position [lng, lat]
        zoom: 11 // starting zoom
    })

    const camdenData = {{ camden | safe}}

    const addPolygon = (map, geometry) => {
        map.addSource(geometry.Name, {
            'type': 'geojson',
            'data': {
              'type': 'Feature',
              'geometry': {
                type: 'Polygon',
                coordinates: [
                  geometry.Geometry
                ]
              },
              'properties': {
                'entity': geometry.entity,
                'name': geometry.Name,
              }
            },
        })

        let layer = map.addLayer({
          id: geometry.Name,
          source: geometry.Name,
          type: 'fill',
          layout: {},
          paint: {
            'fill-color': 'red',
          },
        });
    }

    const addCamdenDataToMap = (map) => {
        camdenData.forEach((geometry) => {
            addPolygon(map, geometry);
        });
    }


    map.on('load', () => {
      addCamdenDataToMap(map)
    })
  </script>
{% endblock %}
